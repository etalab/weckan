{% extends "site.html" %}

{% set style = 'search' %}

{% block title %}{% trans %}Search{% endtrans %}{% endblock %}

{% block content %}
<div class="container">

    {% if organizations %}
    <h2>{% trans %}Organizations{% endtrans %}</h2>
    <ul class="search-results">
        {% for organization in organizations %}
        <li class="search-result organization-result">
            <a class="pull-left" href="{{ url(lang, 'organization', organization.name) }}">
                <img class="result-logo" alt="{{ organization.display_name }}"
                    src="{{ organization.image_url or static('/base/images/placeholder-organization.png') }}">
            </a>
            <div class="result-body">
                <h4>
                    <a href="{{ url(lang, 'organization', organization.name) }}" title="{{organization.display_name}}">
                    {{ organization.display_name }}
                    </a>
                </h4>
                {{ markdown_extract(organization.description, 180) }}
            </div>
        </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if datasets %}
    <h2>{% trans %}Datasets{% endtrans %}</h2>
    <ul class="search-results">
        {% for dataset in datasets %}
        <li class="search-result dataset-result">
            <a class="pull-left" href="{{ url(lang, 'dataset', dataset.name) }}">
                <img class="result-logo" alt="{{ dataset.organization.display_name }}"
                    src="{{ dataset.organization.image_url or static('/base/images/placeholder-organization.png') }}">
            </a>
            <div class="result-body">
                <h4>
                    <a href="{{ url(lang, 'dataset', dataset.name) }}" title="{{dataset.display_name}}">
                    {{ dataset.display_name }}
                    </a>
                </h4>
                {{ markdown_extract(dataset.notes, 180) }}
                <ul class="list-inline result-infos">

                    {# Temporal coverage #}
                    {% if dataset.temporal_coverage.from and dataset.temporal_coverage.to %}
                    <li>
                        <a href class="btn btn-xs btn-default" rel="tooltip" data-placement="left"
                            title="{% trans %}Temporal coverage{% endtrans %}">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </a>
                        {% trans from=dataset.temporal_coverage.from|date(locale=lang), to=dataset.temporal_coverage.to|date(locale=lang) -%}
                        {{ from }} to {{ to }}
                        {%- endtrans %}
                    </li>
                    {% endif %}

                    {# Periodicity #}
                    {% if dataset.periodicity %}
                    <li>
                        <a href class="btn btn-xs" rel="tooltip" data-placement="left"
                            title="{% trans %}Periodicity{% endtrans %}">
                            <span class="glyphicon glyphicon-time"></span>
                        </a>
                        {{ dataset.periodicity }}
                    </li>
                    {% endif %}

                    {# Territorial coverage #}
                    {% if dataset.territorial_coverage.name %}
                    <li>
                        <a href class="btn btn-xs btn-default" rel="tooltip" data-placement="left"
                            title="{% trans %}Territorial coverage{% endtrans %}">
                            <span class="glyphicon glyphicon-globe"></span>
                        </a>
                        {% set ellipsis = '<a href title="{0}">...</a>'.format(dataset.territorial_coverage.name) %}
                        {{ dataset.territorial_coverage.name|truncate(15, True, ellipsis) }}
                    </li>
                    {% endif %}

                    {% if dataset.territorial_coverage.granularity %}
                    <li>
                        <a href class="btn btn-xs btn-default" rel="tooltip" data-placement="left"
                            title="{% trans %}Territorial coverage granularity{% endtrans %}">
                            <span class="glyphicon glyphicon-screenshot"></span>
                        </a>
                        {{ dataset.territorial_coverage.granularity }}
                    </li>
                    {% endif %}

                </ul>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if topics %}
    <h2>{% trans %}Topics{% endtrans %}</h2>
    <ul class="search-results">
        {% for topic in topics %}
        <li class="search-result topic-result">
            <span class="glyphicon glyphicon-info-sign pull-left"></span>
            <h4>
                <a href="{{ WIKI_URL }}/{{ topic.title }}" title="{{ topic.title }}">
                    {{ topic.title }}
                </a>
            </h4>
        </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if questions %}
    <h2>{% trans %}Questions{% endtrans %}</h2>
    <ul class="search-results">
        {% for question in questions %}
        <li class="search-result question-result">
            <span class="glyphicon glyphicon-question-sign pull-left"></span>
            <h4>
                <a href="{{question.url}}" title="{{question.title}}">
                    {{ question.title }}
                </a>
            </h4>
        </li>
        {% endfor %}
    </ul>
    {% endif %}

</div>
{% endblock %}
